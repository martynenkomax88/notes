---
id: exploit_setuid_binaries
aliases:
  - SETUID
tags:
  - privilege_escalation
  - linux
---

## Usage:
The setuid/setgid (SUID/SGID) bits allows the binary to run with the privileges of the user/group owner instead of those of the user executing it. They can be spotted with the s or S permission in the file user or group owner permissions (i.e. ---s--s---). When the file permissions features an uppercase S instead of a lowercase one, it means the corresponding user or group owner doesn't have execution rights. 
> [!WARNING]
> - Just like capabilities, setuid and setgid bits are unset when a file is copied with cp or when its content changes.
> - Some partitions of the UNIX file system can be mounted with the nosuid option. In this case the setuid and setgid bits are ignored for binaries placed inside those partitions. It is a common good practice for tmpfs partitions like /tmp or/run. Searching the /proc/mounts pseudo-file for a nosuid flag can help find these partitions.

## Find SETUID:
- `sudo -l`
- find:
```bash
find $starting_path -perm -u=s -type f 2>/dev/null

# Or in octal mode
find $starting_path -perm -4000 -type f 2>/dev/null
  ```

## Exploit SETUID:
### Living off the land:
> [!WARNING]
> Check if the binary is in [GTFOBins](https://gtfobins.github.io/gtfobins/) for exploitation techniques
#### Examples:

### Relative path calls:
  1. Usage:
    - The SETUID can be exploited if it makes calls via relative starting_path
  2. Discovery:
    - It can be discovered with `strace` command
  3. Exploitation:
    - Create an exploit and name it the same as the command called by the SETUID
    - Put the exploit path in the $PATH env variable
    - Now when the SRYUID will make the call it will search for it in PATH and execute the exploit
